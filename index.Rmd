---
title: "SOCI 133 Fall 2020 - Class Research"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    theme: united
---

<style>
.colored {
  background-color: #e4e2d8;
}
</style>


```{r setup, include=FALSE}
library(tidyverse)
library(crosstalk)
library(hrbrthemes)
library(gmodels)
library(flexdashboard)
library(plotly)
library(leaflet)
library(numform)
library(USAboundaries)
library(gridExtra)
library(ggmap)
library(DT)
library(knitr)
library(tigris)
library(devtools)
library(rappdirs)
library(leaflet)
library(htmlwidgets)
library(sp)
library(dplyr)
library(rgeos)
library(rgdal)
library(maptools)
library(sf)
library(spdep)
library(mapview)
library(USAboundariesData)
library(broom)

```



```{r, include=FALSE}
filename <- 'https://davidrigbysociology.s3.amazonaws.com/anes_1946-2016.csv' # Paste the file location for the data set between this set of quotation marks and run this code

#   d) Read the data file into R and assign it in an object named anes
anes <- read.csv(filename, stringsAsFactors = FALSE)

```

Engagement {data-orientation=rows}
===========================================================

Row {.tabset .tabset-fade data-height=600}
--------------------------------------------------------

### Partisanship & Campaign Event Attendance - Kate Bailey

My research allows for a deeper understanding of American politics and suggests which citizens are likely to be the most engaged. I was motivated to ask the question because I had been discussing politics with a family member who is registered as an independent. The family member happened to be uninterested in the campaign rally happening down the street, neither strongly disliking the candidate, nor liking them to the point they wished to attend. This was strange to me as most other individuals in my life (who happen to be strong partisans) would have either jumped on the chance to attend or stayed as far away from the area as they could. I feel it is important to measure as American politics are so hostile right now, that the country could learn from the proven “indifference” of registered independents. 

My research speaks to the themes of political engagement, sorting, and polarization. Political engagement is a given, as attending campaign rallies is a direct indication of engagement. Sorting comes into play when people allow themselves to be allocated into the role of strong democrat or strong republican and thoroughly enjoy the social aspect of it. These groups are usually at conflict with each other forcing them to ideologically separate from another. This also deals with polarization as the sorting causes a political divide. 

### Partisanship & Event Attendance (Time Trend)
```{r}
poldata <- anes
poldata$Age[poldata$Age=="97. 97 years old (1952, 1974, 1996 and later: or older); 2012,2016: 90"] <- 97
poldata$Age[poldata$Age=="98. 98 years old (1958-1962, 1966, 1968: or older)"] <- 98
poldata$Age[poldata$Age=="99. 99 years old (1976-1990,1994,2002: or older)"] <- 99
poldata$Age <- as.numeric(poldata$Age)

# Political Activity
poldata$Political_Activity[poldata$campaign_activity_count=="1. Lowest level of participation (none)"] <- 1
poldata$Political_Activity[poldata$campaign_activity_count=="2"] <- 2
poldata$Political_Activity[poldata$campaign_activity_count=="3"] <- 3
poldata$Political_Activity[poldata$campaign_activity_count=="4"] <- 4
poldata$Political_Activity[poldata$campaign_activity_count=="5"] <- 5
poldata$Political_Activity[poldata$campaign_activity_count=="6. Highest level of participation in campaign activities"] <- 6

#Respondent's Partisan ID
poldata$party_3[poldata$Party_ID_3=="1. Democrats (including leaners)"] <- 1
poldata$party_3[poldata$Party_ID_3=="2. Independents"] <- 2
poldata$party_3[poldata$Party_ID_3=="3. Republicans (including leaners)"] <- 2


# Male
poldata$Female[poldata$Gender=="2. Female"] <- 1
poldata$Female[poldata$Gender=="1. Male"] <- 0

# Race
poldata$Black <- 0
poldata$Black[poldata$Race_4=="2. Black non-Hispanic"] <- 1
poldata$White <- 0
poldata$White[poldata$Race_4=="1. White non-Hispanic"] <- 1
poldata$Latino <- 0
poldata$Latino[poldata$Race_4=="3. Hispanic"] <- 1

# Education
poldata$Grade_School <- 0
poldata$Grade_School[poldata$Education_4=="1. Grade school or less (0-8 grades)"] <- 1
poldata$High_School <- 0
poldata$High_School[poldata$Education_4=="2. High school (12 grades or fewer, incl. non-college"] <- 1
poldata$Some_College <- 0
poldata$Some_College[poldata$Education_4=="3. Some college (13 grades or more but no degree;"] <- 1
poldata$College <- 0
poldata$College[poldata$Education_4=="4. College or advanced degree (no cases 1948)"] <- 1

# Household Income Distribution
poldata$HHIncome[poldata$Family_Income_Group=="1. 0 to 16 percentile"] <- 1
poldata$HHIncome[poldata$Family_Income_Group=="2. 17 to 33 percentile"] <- 2
poldata$HHIncome[poldata$Family_Income_Group=="3. 34 to 67 percentile"] <- 3
poldata$HHIncome[poldata$Family_Income_Group=="4. 68 to 95 percentile"] <- 4
poldata$HHIncome[poldata$Family_Income_Group=="5. 96 to 100 percentile"] <- 5


# Race
poldata$Black <- 0
poldata$Black[poldata$Race_4=="2. Black non-Hispanic"] <- 1
poldata$White <- 0
poldata$White[poldata$Race_4=="1. White non-Hispanic"] <- 1
poldata$Latino <- 0
poldata$Latino[poldata$Race_4=="3. Hispanic"] <- 1


# Party Identification
poldata$Republican[poldata$Party_ID_7=="3. Independent - Democrat" |poldata$Party_ID_7=="2. Weak Democrat"|poldata$Party_ID_7=="1. Strong Democrat"] <- 0
poldata$Republican[poldata$Party_ID_7=="5. Independent - Republican" |poldata$Party_ID_7=="6. Weak Republican"|poldata$Party_ID_7=="7. Strong Republican"] <- 1

poldata$Democrat[poldata$Party_ID_7=="3. Independent - Democrat"   |poldata$Party_ID_7=="2. Weak Democrat"  |poldata$Party_ID_7=="1. Strong Democrat"] <- 1
poldata$Democrat[poldata$Party_ID_7=="5. Independent - Republican" |poldata$Party_ID_7=="6. Weak Republican"|poldata$Party_ID_7=="7. Strong Republican"] <- 0

# Do people live in cities, suburbs, or rural areas?
# City
poldata$City[poldata$Urban=="1. Central cities"] <- 1
poldata$City[poldata$Urban=="2. Suburban areas"|poldata$Urban=="3. Rural, small towns, outlying and adjacent areas"] <- 0

# Suburbs
poldata$Suburb[poldata$Urban=="2. Suburban areas"] <- 1
poldata$Suburb[poldata$Urban=="1. Central cities"|poldata$Urban=="3. Rural, small towns, outlying and adjacent areas"] <- 0

# Rural
poldata$Rural[poldata$Urban=="3. Rural, small towns, outlying and adjacent areas"] <- 1
poldata$Rural[poldata$Urban=="1. Central cities"|poldata$Urban=="2. Suburban areas"] <- 0


# Create an indicator variable for whether a respondent self-identifies as a political Independent
partisan <- poldata[poldata$Party_ID_7!="",]
partisan$independent[partisan$Party_ID_7 != "4. Independent - Independent"] <- 0
partisan$independent[partisan$Party_ID_7 == "4. Independent - Independent"] <- 1

# Create an indicator variable for whether a respondent self-identifies as either a "Strong Democrat" or a "Strong Republican"
partisan$strongpartisan[partisan$Party_ID_7 == "1. Strong Democrat" | partisan$Party_ID_7 == "7. Strong Republican"] <- 1
partisan$strongpartisan[partisan$Party_ID_7 != "1. Strong Democrat" & partisan$Party_ID_7 != "7. Strong Republican"] <- 0

partisan$attendance[partisan$attend_meetings=="1. No"] <- 0
partisan$attendance[partisan$attend_meetings=="2. Yes"] <- 1


meetings <- group_by(subset(partisan, Year>=1970), Year) %>% 
  mutate(prop.partisan_attend = mean(attend_meetings == '2. Yes' & strongpartisan==1),
         prop.independent_attend = mean(attend_meetings == '2. Yes' & independent==1))

attendance_change <- ggplot() + 
  geom_line(data = meetings, aes(x = Year, y = prop.partisan_attend, text = "<b>Proportion of Strong Partisans that Attended Campaign Event</b>"),
            color = "Purple") +
  geom_line(data = meetings, aes(x = Year, y = prop.independent_attend, text = "<b>Proportion of Indpendents that Attended Campaign Event</b>"),
            color = "Yellow") +
  xlab('Year') +
  ylab('Proportion of Electorate') +
  ggtitle("Change in Campaign Event Attendance, by Partisanship Strength (1970-2016)") +
  theme(plot.title = element_text(size = 12)) +
  theme(legend.title = element_blank()) +
  theme(axis.title=element_text(size=8))

attendance_change <- ggplotly(attendance_change)
attendance_change

```


### Partisanship & Event Attendance (Regression)
```{r}

#Run model
csm2.fit <- glm(attendance ~ strongpartisan + independent + Age + Year, data = partisan) #Specify model

cases_model_df <- tidy(csm2.fit, conf.int = TRUE) %>% 
  filter(!str_detect(term, 'factor|Intercept'))

# rename terms using lists above
# get only significant (at 0.05 level) IVs
cond_cases_model <- cases_model_df %>% 
  filter(p.value < 0.05 & !str_detect(term, 'tests'))
# reorder vars for plot
cases_new_order <- order(cond_cases_model$estimate, decreasing = FALSE)
cond_cases_model$term <- as.character(cond_cases_model$term)
cond_cases_model$term <- factor(cond_cases_model$term, levels = cond_cases_model$term[cases_new_order])
# plot coefficient plot

plot_cases <- ggplot(cond_cases_model, aes(x=term, y = estimate)) + 
  geom_hline(yintercept=0, colour="#8C2318") +  # Line at 0
  geom_pointrange(aes(ymin=conf.low, ymax=conf.high)) +  # Ranges for each coefficient
  labs(x="Coefficient", y="Estimate", title="Coefficient Estimates of Strength of \nPartisanship on Campaign Event Attendance") +
  theme(plot.title = element_text(size = 6)) +
  theme(legend.title = element_blank()) +
  theme(axis.title=element_text(size=8)) +
  coord_flip() +
  theme_minimal()

plot_cases
```


Row {.tabset .tabset-fade data-height=600}
--------------------------------------------

### Ideology and Political Engagement - Erin Bostic

My research helps to explain the relationship between political ideology and political participation. My research adds to the understanding about which ideology, Liberals or Conservatives, is more likely to participate politically. I was motivated by the divide between the two ideologies in the last election (2016) and also the increase rate of political participation in the recent years. Also by Putnam’s findings that although more people are becoming politically engaged, less people are voting. The evidence found is important because it gives an idea on which ideology participates more given a controversial issue. This knowledge could help us to predict the participation levels by ideology in the future.

My analysis of trends in political activity between liberals and conservatives over the last 50 years shows that overall, liberals were more likely to politically active than conservatives.  

I am also interested in the relationship between policy preferences and political participation. My next graph shows the attitudes about abortion by ideology in 1980 and 2016. The liberals are represented in blue while conservatives. are in red. In both 1980 and 2016 liberals expressed high opinions about abortion being unrestricted while a lot of less conservatives expressed opposite ideas. This graph shows that liberals in both 1980 and 2016 were more politically engaged on the idea of abortion than conservatives. 


### Ideology and Political Engagement (Time Trend)

```{r}

# Political Activity
bostic <- anes
bostic$Political_Activity[bostic$campaign_activity_count=="1. Lowest level of participation (none)"] <- 1
bostic$Political_Activity[bostic$campaign_activity_count=="2"] <- 2
bostic$Political_Activity[bostic$campaign_activity_count=="3"] <- 3
bostic$Political_Activity[bostic$campaign_activity_count=="4"] <- 4
bostic$Political_Activity[bostic$campaign_activity_count=="5"] <- 5
bostic$Political_Activity[bostic$campaign_activity_count=="6. Highest level of participation in campaign activities"] <- 6

# Father's Political Interest
bostic$Political_Interest_Father[bostic$Political_Interest_Father=="1. Didn't pay much attention"] <- 1
bostic$Political_Interest_Father[bostic$Political_Interest_Father=="2. Somewhat interested"] <- 2
bostic$Political_Interest_Father[bostic$Political_Interest_Father=="3. Very much interested"] <- 3
bostic$Political_Interest_Father <- as.numeric(bostic$Political_Interest_Father)

# Mother's Political Interest
bostic$Political_Interest_Mother[bostic$Political_Interest_Mother=="1. Didn't pay much attention"] <- 1
bostic$Political_Interest_Mother[bostic$Political_Interest_Mother=="2. Somewhat interested"] <- 2
bostic$Political_Interest_Mother[bostic$Political_Interest_Mother=="3. Very much interested"] <- 3
bostic$Political_Interest_Mother <- as.numeric(bostic$Political_Interest_Mother)

# Father's Partisan ID
bostic$party_father3[bostic$Party_ID_Father=="1. Democrat"] <- 1
bostic$party_father3[bostic$Party_ID_Father=="2. Independent (some years also: shifted around)"] <- 2
bostic$party_father3[bostic$Party_ID_Father=="3. Republican"] <- 3



# Father's Democrat and Republican indicator variables
bostic$father_democrat[bostic$Party_ID_Father!="1. Democrat"] <- 0
bostic$father_democrat[bostic$Party_ID_Father=="1. Democrat"] <- 1

bostic$father_republican[bostic$Party_ID_Father!="3. Republican"] <- 0
bostic$father_republican[bostic$Party_ID_Father=="3. Republican"] <- 1


# Mother's Partisan ID
bostic$party_mother3[bostic$Party_ID_Mother=="1. Democrat"] <- 1
bostic$party_mother3[bostic$Party_ID_Mother=="2. Independent (some years also: shifted around)"] <- 2
bostic$party_mother3[bostic$Party_ID_Mother=="3. Republican"] <- 3

# Mother's Democrat and Republican indicator variables
bostic$mother_democrat[bostic$Party_ID_Mother!="1. Democrat"] <- 0
bostic$mother_democrat[bostic$Party_ID_Mother=="1. Democrat"] <- 1

bostic$mother_republican[bostic$Party_ID_Mother!="3. Republican"] <- 0
bostic$mother_republican[bostic$Party_ID_Mother=="3. Republican"] <- 1


#Respondent's Partisan ID
bostic$party_3[bostic$Party_ID_3=="1. Democrats (including leaners)"] <- 1
bostic$party_3[bostic$Party_ID_3=="2. Independents"] <- 2
bostic$party_3[bostic$Party_ID_3=="3. Republicans (including leaners)"] <- 2

# Respondent Democrat and Republican indicator variables
bostic$Republican[bostic$Party_ID_7=="3. Independent - Democrat" |bostic$Party_ID_7=="2. Weak Democrat"|bostic$Party_ID_7=="1. Strong Democrat"] <- 0
bostic$Republican[bostic$Party_ID_7=="5. Independent - Republican" |bostic$Party_ID_7=="6. Weak Republican"|bostic$Party_ID_7=="7. Strong Republican"] <- 1


bostic$Democrat[bostic$Party_ID_7=="3. Independent - Democrat"   |bostic$Party_ID_7=="2. Weak Democrat"  |bostic$Party_ID_7=="1. Strong Democrat"] <- 1
bostic$Democrat[bostic$Party_ID_7=="5. Independent - Republican" |bostic$Party_ID_7=="6. Weak Republican"|bostic$Party_ID_7=="7. Strong Republican"] <- 0


# Ideology
bostic$strong_lib[bostic$Ideology_ID_7=="1. Extremely liberal"] <- 3
bostic$strong_lib[bostic$Ideology_ID_7=="2. Liberal"] <- 2
bostic$strong_lib[bostic$Ideology_ID_7=="3. Slightly liberal"] <- 1

bostic$strong_con[bostic$Ideology_ID_7=="7. Extremely conservative"] <- 3
bostic$strong_con[bostic$Ideology_ID_7=="6. Conservative"] <- 2
bostic$strong_con[bostic$Ideology_ID_7=="5. Slightly conservative"] <- 1

bostic$ideology2[bostic$Ideology_ID_7=="1. Extremely liberal"|bostic$Ideology_ID_7=="2. Liberal"|bostic$Ideology_ID_7=="3. Slightly liberal"] <- "Liberal"
bostic$ideology2[bostic$Ideology_ID_7=="7. Extremely conservative"|bostic$Ideology_ID_7=="6. Conservative"|bostic$Ideology_ID_7=="5. Slightly conservative"] <- "Conservative"

# Democrat/Republican - 2 Category
bostic$party2[bostic$Democrat==1] <- "Democrat"
bostic$party2[bostic$Republican==1] <- "Republican"

# Correspondence b/w Father's and Child's Partisan ID
bostic$gensort <- abs(bostic$party_3-bostic$party_father3)

# Age
bostic$Age[bostic$Age=="97. 97 years old (1952, 1974, 1996 and later: or older); 2012,2016: 90"] <- 97
bostic$Age[bostic$Age=="98. 98 years old (1958-1962, 1966, 1968: or older)"] <- 98
bostic$Age[bostic$Age=="99. 99 years old (1976-1990,1994,2002: or older)"] <- 99
bostic$Age <- as.numeric(bostic$Age)  

# Male
bostic$Male[bostic$Gender=="2. Female" | bostic$Gender=="3. Other (2016)"] <- 0
bostic$Male[bostic$Gender=="1. Male"] <- 1

# Race
bostic$Race_4[bostic$Race_4==""] <- NA
bostic$Black[bostic$Race_4!="2. Black non-Hispanic"] <- 0
bostic$Black[bostic$Race_4=="2. Black non-Hispanic"] <- 1
bostic$White[bostic$Race_4!="1. White non-Hispanic"] <- 0
bostic$White[bostic$Race_4=="1. White non-Hispanic"] <- 1

bostic$Latino[bostic$Race_4!="3. Hispanic"] <- 0
bostic$Latino[bostic$Race_4=="3. Hispanic"] <- 1

#Grade School
bostic$gradeschool[bostic$Education_4!="1. Grade school or less (0-8 grades)"] <- 0
bostic$gradeschool[bostic$Education_4=="1. Grade school or less (0-8 grades)"] <- 1

#High School
bostic$highschool[bostic$Education_4!="2. High school (12 grades or fewer, incl. non-college"] <- 0
bostic$highschool[bostic$Education_4=="2. High school (12 grades or fewer, incl. non-college"] <- 1

#Some College
bostic$somecollege[bostic$Education_4!="3. Some college (13 grades or more but no degree;"] <- 0
bostic$somecollege[bostic$Education_4=="3. Some college (13 grades or more but no degree;"] <- 1

#College
bostic$college[bostic$Education_4!="4. College or advanced degree (no cases 1948)"] <- 0
bostic$college[bostic$Education_4=="4. College or advanced degree (no cases 1948)"] <- 1

#Income
bostic$income_bottomthird[bostic$Family_Income=="1. 0 to 16 percentile" | bostic$Family_Income=="2. 17 to 33 percentile"] <- 1
bostic$income_bottomthird[bostic$Family_Income!="1. 0 to 16 percentile" & bostic$Family_Income!="2. 17 to 33 percentile"] <- 0

# Voted
bostic$Voted[bostic$Voted=="1. No, did not vote"] <- 0
bostic$Voted[bostic$Voted=="2. Yes, voted"]      <- 1
bostic$Voted <- as.numeric(bostic$Voted)

bostic$pcolor[bostic$ideology2=="Conservative"] <- "blue"
bostic$pcolor[bostic$ideology2=="Liberal"] <- "red"


# Trend in average engagement, by ideology
ideology_trend <- subset(bostic, !is.na(ideology2) & !is.na(Political_Activity)) %>%
                  group_by(Year) %>%
                  mutate(liberal.engagement = mean(Political_Activity[ideology2=="Liberal"]),
                         conservative.engagement = mean(Political_Activity[ideology2=="Conservative"]))


ggplotly(ggplot() + 
           geom_line(data = ideology_trend, aes(x = Year, y = liberal.engagement, text = "<b>Average Political Activity</b>"), color="blue") +
           geom_line(data = ideology_trend, aes(x = Year, y = conservative.engagement, text = "<b>Average Political Activity</b>"), color="red") +
           xlab('Year') +
           ylab('Political Activity Scale (0-6)') +
           ggtitle("Political Activity by Ideology (bostic 1950-2016)") +
           theme(plot.title = element_text(size = 12)) +
           theme(legend.title = element_blank()) +
           theme(axis.title=element_text(size=8)))


```

### Ideology and Attitudes on Abortion

```{r}
  
    # Attitudes on Abortion, by ideology
    bostic$abortion[bostic$Abortion_Legal=="1. By law, abortion should never be permitted"] <- 4
    bostic$abortion[bostic$Abortion_Legal=="2. The law should permit abortion only in case of rape,"] <- 3
    bostic$abortion[bostic$Abortion_Legal=="3. The law should permit abortion for reasons other than"] <- 2
    bostic$abortion[bostic$Abortion_Legal=="4. By law, a woman should always be able to obtain an"] <- 1

    #Graphs
    p6 <- ggplotly(ggplot(data=subset(bostic, Year==1980 & !is.na(ideology2) & !is.na(abortion)), aes(x=abortion, group=ideology2,fill = pcolor)) +
               theme(legend.position="none") +
               geom_density(adjust=1.5, alpha=.4) +
               ggtitle("Abortion Attitudes by ideology | Left = 1980, Right = 2016") +
               scale_x_continuous(breaks = c(1,2,3,4), labels = c('Unrestricted','Clear Need','Health risk','Never')) +
               theme_ipsum())
    
   p7 <- ggplotly(ggplot(data=subset(bostic, Year==2016 & !is.na(ideology2) & !is.na(abortion)), aes(x=abortion, group=ideology2,fill = pcolor)) +
               theme(legend.position="none") +
               geom_density(adjust=1.5, alpha=.4) +
               ggtitle("Abortion Attitudes by Gender, 2016") +
                 scale_x_continuous(breaks = c(1,2,3,4), labels = c('Unrestricted','Clear Need','Health risk','Never')) +
                 theme_ipsum())
    
   subplot(p6, style(p7, showlegend = FALSE),  titleY = TRUE, which_layout = 1)
   
```



Row {.tabset .tabset-fade data-height=600}
--------------------------------------------

### Media Exposure and Engagement - Aleenih Carter-Key

My research investigated the idea of how does mass media impact civic engagement. This research added to my understanding of politics because it helped me really see how much screen time and other media rallies up the masses to get them to participate politically. I was motivated to ask this question because I use mass media very often and I always am exposed to political content; so, I thought that this was a great topic to explore. This knowledge is important because it shows that people who are more often exposed to certain types of media are more likely than those who are not exposed to certain types of media to be civically engaged.

My first coefficient plot presents the results of a logit regression of the likelihood of voting. This model shows that people that listen to the radio or read newspapers frequently are more likely to vote than people who watch TV frequently, even when controlling for other sources of media

My next plot presents the results of a logit regression of the likelihood of attending a campaign event or rally. My results show that people who frequently read the newspaper and listen to the radio for political information are significantly more likely to go to meetings than those who watch tv.


### Media Exposure and Voting (Regression)

```{r}

aleenih <- anes
# Voting
aleenih$Voted[aleenih$Voted=="1. No, did not vote"] <- 0
aleenih$Voted[aleenih$Voted=="2. Yes, voted"] <- 1   
aleenih$Voted <- as.numeric(aleenih$Voted)

# TV

aleenih$TV_frequency[aleenih$TV_frequency=="0. None"] <- 0
aleenih$TV_frequency[aleenih$TV_frequency=="1. One day"] <- 1
aleenih$TV_frequency[aleenih$TV_frequency=="7. Every day"] <- 7
aleenih$TV_frequency <- as.numeric(aleenih$TV_frequency)

# Radio

aleenih$Radio_frequency[aleenih$Radio_frequency=="None ('No')"] <- 0
aleenih$Radio_frequency[aleenih$Radio_frequency=="3. Several"] <- 2
aleenih$Radio_frequency[aleenih$Radio_frequency=="1. Good many"] <- 3
aleenih$Radio_frequency[aleenih$Radio_frequency=="5. One or two"] <- 1
aleenih$Radio_frequency <- as.numeric(aleenih$Radio_frequency)

# Newspaper

aleenih$Newspaper_frequency[aleenih$Newspaper_frequency=="0. None"] <- 0
aleenih$Newspaper_frequency[aleenih$Newspaper_frequency=="1. One day "] <- 1
aleenih$Newspaper_frequency[aleenih$Newspaper_frequency=="7. Every day"] <- 7
aleenih$Newspaper_frequency <- as.numeric(aleenih$Newspaper_frequency)

#Verify class of variables

# Attend political ralleys or meetings
aleenih$attendance[aleenih$attend_meetings=="1. No"] <- 0
aleenih$attendance[aleenih$attend_meetings=="2. Yes"] <- 1

# Age
table(aleenih$Age)
aleenih$Age[aleenih$Age=="97. 97 years old (1952, 1974, 1996 and later: or older); 2012,2016: 90"] <- 97
aleenih$Age[aleenih$Age=="98. 98 years old (1958-1962, 1966, 1968: or older)"] <- 98
aleenih$Age[aleenih$Age=="99. 99 years old (1976-1990,1994,2002: or older)"] <- 99
aleenih$Age <- as.numeric(aleenih$Age)  

#Run Voting model
tv_vote <- glm(Voted ~ TV_frequency + Radio_frequency + Newspaper_frequency + Year + Age, data = aleenih) #Specify model

tv_model <- tidy(tv_vote, conf.int = TRUE) %>% 
  filter(!str_detect(term, 'factor|Intercept'))

# rename terms using lists above
# get only significant (at 0.05 level) IVs

# reorder vars for plot
new_order <- order(tv_model$estimate, decreasing = FALSE)
tv_model$term <- as.character(tv_model$term)
tv_model$term <- factor(tv_model$term, levels = tv_model$term[new_order])
# plot coefficient plot

tv_plot <- ggplot(tv_model, aes(x=term, y = estimate)) + 
  geom_hline(yintercept=0, colour="#8C2318") +  # Line at 0
  geom_pointrange(aes(ymin=conf.low, ymax=conf.high)) +  # Ranges for each coefficient
  labs(x="Coefficient", y="Estimate", title="Coefficient Estimates of Regression Model of \nMedia Usage on Likelihood of Voting") +
  theme(plot.title = element_text(size = 6)) +
  theme(legend.title = element_blank()) +
  theme(axis.title=element_text(size=8)) +
  coord_flip() +
  theme_minimal()

tv_plot

```


### Media Exposure and Campaign Event Attendance (Regression)

```{r}
#Run Meeting model
attend_model <- glm(attendance ~ TV_frequency + Radio_frequency + Newspaper_frequency + Year + Age, data = aleenih) #Specify model

att_model <- tidy(attend_model, conf.int = TRUE) %>% 
  filter(!str_detect(term, 'factor|Intercept'))

# rename terms using lists above
# get only significant (at 0.05 level) IVs

# reorder vars for plot
new_order <- order(att_model$estimate, decreasing = FALSE)
att_model$term <- as.character(att_model$term)
att_model$term <- factor(att_model$term, levels = att_model$term[new_order])
# plot coefficient plot

att_plot <- ggplot(att_model, aes(x=term, y = estimate)) + 
  geom_hline(yintercept=0, colour="#8C2318") +  # Line at 0
  geom_pointrange(aes(ymin=conf.low, ymax=conf.high)) +  # Ranges for each coefficient
  labs(x="Coefficient", y="Estimate", title="Coefficient Estimates of Regression Model of Media \nUsage on Likelihood of Attending Campaign Event") +
  theme(plot.title = element_text(size = 6)) +
  theme(legend.title = element_blank()) +
  theme(axis.title=element_text(size=8)) +
  coord_flip() +
  theme_minimal()

att_plot
```


More Student Research {data-icon="fa-map"}
===========================================================

```{r, include=FALSE}

slave <- read.csv("https://davidrigbysociology.s3.amazonaws.com/lynching_data/1860_slave_pop.csv", stringsAsFactors=F)
slave$fips <- sprintf("%05d", slave$fips)
slave$stot <- as.numeric(slave$stot)
slave$slave_prop <- as.numeric(slave$slave_prop)
dot_data <- read.csv("https://davidrigbysociology.s3.amazonaws.com/lynching_data/make_dot_map_with_this_03.csv", colClasses='character', stringsAsFactors=F)
datatable(head(dot_data))
sapply(dot_data,class)
dot_data$verified <- as.numeric(dot_data$verified)
dot_data$verified <-replace_na(dot_data$verified)



black_dot_data <- subset(dot_data, race_count == "Black")

options(tigris_use_cache = TRUE)


us_county_shape <- counties(state = NULL, cb = TRUE, year = NULL)
cds <- coordinates(us_county_shape)
dot_coords <- cbind(as.data.frame(cds) %>% setNames(c("long","lat")),us_county_shape@data['GEOID'])
county_merge <- sp::merge(us_county_shape,dot_coords, by = "GEOID")
dot_merged <- sp::merge(county_merge, black_dot_data, by = "GEOID", duplicateGeoms = TRUE)

color_race <- c("Black" = "#D4820F")

lynchings <- dplyr::filter(dot_merged@data, verified==1)
lynchings$colors <- color_race[lynchings$race_count]
lynchings$long_jit <- jitter(lynchings$long, factor = 80)
lynchings$lat_jit <- jitter(lynchings$lat, factor = 80)

slave_shape <- us_counties(map_date = "1860-12-30",
                               resolution = "high")

slave_merge <- sp::merge(slave_shape, slave, by = "fips", duplicateGeoms = TRUE, all.x=TRUE)

### % Slave Proportion
cutpoints <- c(0, quantile(slave$slave_prop, 0.20, na.rm=TRUE), quantile(slave$slave_prop, 0.40, na.rm=TRUE), 
               quantile(slave$slave_prop, 0.60, na.rm=TRUE), quantile(slave$slave_prop, 0.80, na.rm=TRUE),
               quantile(slave$slave_prop, 0.90, na.rm=TRUE), quantile(slave$slave_prop, 1.0, na.rm=TRUE))
cutpoints

cat_list <- c("0", 				
              "0-0.0631", 		
              "0.06311-0.1666", 	
              "0.16661-0.3221", 	
              "0.32211-0.4957", 	
              "0.49571-0.601", 	
              "0.6011-0.925")
cat_list[4]

### ENTER slavebin values into 1860 shape file for old jurisdictions missinf fips
slave_merge$propbin[slave_merge$full_name == "Horry District" & slave_merge$state_name == "South Carolina"] <- cat_list[4]
slave_merge$propbin[slave_merge$full_name == "Prince Frederick Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. Mark Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Georgetown District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. James-Santee Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Christ Church Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "St. Philip Parish (superseded" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "St. Andrew Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "St. John-Colleton Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "St. Stephen Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. John-Berkeley Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. James-Goose Creek Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. Thomas / St. Dennis Parishes (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6] 
slave_merge$propbin[slave_merge$full_name == "St. George-Dorchester Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. Bartholomew Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6] 
slave_merge$propbin[slave_merge$full_name == "St. Helena Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. Luke Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. Peter Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. Paul Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Prince William Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Lexington District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Orangeburg District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Barnwell District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Williamsburg District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "St. David Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Orange Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Lancaster District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "York District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Chester District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Fairfield District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Union District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Spartanburg District" & slave_merge$state_name == "South Carolina"] <- cat_list[4]
slave_merge$propbin[slave_merge$full_name == "Greenville District" & slave_merge$state_name == "South Carolina"] <- cat_list[4]
slave_merge$propbin[slave_merge$full_name == "Pickens District" & slave_merge$state_name == "South Carolina"] <- cat_list[4]
slave_merge$propbin[slave_merge$full_name == "Anderson District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Laurens District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Abbeville District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Edgefield District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Newberry District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Sumter District" & slave_merge$state_name == "South Carolina"] <- cat_list[6]
slave_merge$propbin[slave_merge$full_name == "Richland District" & slave_merge$state_name == "South Carolina"] <- cat_list[5]
slave_merge$propbin[slave_merge$full_name == "Prince George-Winyaw Parish (superseded)" & slave_merge$state_name == "South Carolina"] <- cat_list[5]

slave_merge$propbin[slave_merge$full_name == "Indian Territory" & slave_merge$state_name == "Oklahoma"] <- cat_list[2]
slave_merge$propbin[slave_merge$full_name == "GREER" & slave_merge$state_name == "Oklahoma"] <- cat_list[2]

slave_merge$propbin[slave_merge$full_name == "CARROLL (extinct)" & slave_merge$state_name == "Louisiana"] <- cat_list[7]

### Make Map

leaflet(options = leafletOptions(minZoom = 3, maxZoom = 6))
deteup <- paste0("<B>County: ",lynchings$county, " - </B>", lynchings$vic_detes)
popup <- paste0("<B>County: ",slave_merge$full_name, " - </B> State: ",slave_merge$state_name)
binpal <- colorFactor(c("white", "#cecddb", "#9d9bb8", "#6d6994", "#3c3771", "#0a0546"), na.color = "white", domain = slave_merge$propbin)
dot_map <- leaflet() %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = slave_merge,
              stroke = TRUE,
              opacity=.15,
              color="grey", 
              fillColor = ~binpal(slave_merge$propbin), # you need to use hex colors
              fillOpacity = .7, 
              weight = .5, 
              smoothFactor = 0.2
  ) %>%  
  
  addPolylines(data = slave_merge,                  
               stroke = TRUE,
               weight = .5,
               color="grey") %>%
  
  addCircleMarkers(lng = lynchings$long_jit, lat = lynchings$lat_jit, weight=7, opacity = .1, radius =1.5, 
                   color=lynchings$colors, stroke = TRUE, fillOpacity = .6, popup = deteup
  ) %>%
  
  addLegend( 
    colors =  c("white", "#e6e6ec", "#b5b4c7", "#8482a2", "#53507d", "#221d58", "#080438"),
    #labels = c("0", "1-325", "326-1278", "1279-2868", "2869-6033", "6034-8940", "8941-37290"),
    labels = c("0", "0.01-0.06", "0.06-0.16", "0.17-0.32", "0.33-0.49", "0.50-0.60", "0.60-0.93"),
    position = "bottomright", 
    title = "Proportion Enslaved by County (1860 Census)  <br />  •Each Dot Represents 1 Black Lynching Victim")

dot_map
  
slave_lynch_dot <- setView(dot_map, lat = 39, lng = -97, zoom = 5)
```


Column
-----------------

###

```{r}
slave_lynch_dot
```


More Student Research {data-icon="fa-map"}
===========================================================

```{r, include=FALSE}

         
data_ts <- read.csv("https://davidrigbysociology.s3.amazonaws.com/lynching_data/data_for_execution_lynching_map.csv")
data_ts$GEOID <- sprintf("%05s",data_ts$GEOID)

dot_data <- read.csv("https://davidrigbysociology.s3.amazonaws.com/lynching_data/make_dot_map_with_this_03.csv", colClasses='character', stringsAsFactors=F)
dot_data$verified <- as.numeric(dot_data$verified)
lynching_info <- subset(dot_data, race_count=="Black") %>%
                 select(GEOID, vic_detes, verified) 

lynching_info <- lynching_info %>% group_by(GEOID) %>%
                 mutate(Black_Lynching_Count = sum(verified),
                        County_Lynch_List    = paste0(vic_detes,collapse = " </br>")) %>%
                 select(-c(verified,vic_detes))

lynching_info <- lynching_info[!duplicated(lynching_info$GEOID),]

          mapdata <- left_join(data_ts, lynching_info, by = "GEOID", copy = FALSE)

          mapdata$Black_Lynching_Count[is.na(mapdata$Black_Lynching_Count)]<-0

          mapdata$Weighted_EnslavedCount_1860 <- as.numeric(mapdata$Weighted_EnslavedCount_1860)
          mapdata$Weighted_EnslavedCount_1860 [is.na(mapdata$Weighted_EnslavedCount_1860)] <- 0

          mapdata$Weighted_TotPop_1860 <- as.numeric(mapdata$Weighted_TotPop_1860)
          mapdata$Weighted_TotPop_1860[is.na(mapdata$Weighted_TotPop_1860)] <- 0
          
          
          mapdata$State_Fips_2017 <- sprintf("%02s",data_ts$State_Fips_2017)
          mapdata$slave_state = 0
          mapdata$slave_state[mapdata$State_Fips_2017=="48"|mapdata$State_Fips_2017=="22"|mapdata$State_Fips_2017=="01"|
                                mapdata$State_Fips_2017=="28"|mapdata$State_Fips_2017=="29"|mapdata$State_Fips_2017=="05"|
                                mapdata$State_Fips_2017=="40"|mapdata$State_Fips_2017=="13"|mapdata$State_Fips_2017=="12"|
                                mapdata$State_Fips_2017=="45"|mapdata$State_Fips_2017=="37"|mapdata$State_Fips_2017=="51"|
                                mapdata$State_Fips_2017=="54"|mapdata$State_Fips_2017=="10"|mapdata$State_Fips_2017=="24"|
                                mapdata$State_Fips_2017=="47"|mapdata$State_Fips_2017=="21"] <- 1

          mapdata$slave_prop <- mapdata$Weighted_EnslavedCount_1860/mapdata$Weighted_TotPop_1860

          
          mapdata$slave_prop[mapdata$State_2017=="New Jersey"|mapdata$State_2017=="Kansas"|mapdata$State_2017=="Nebraska"|
                             mapdata$State_2017=="Pennsylvania"|mapdata$State_2017=="New York"|mapdata$State_2017=="New Mexico"|
                             mapdata$State_2017=="Illinois"] <- 0
          
          mapdata$slave_prop[mapdata$State_2017=="Maryland" & mapdata$County_2017=="Washington"]        <- 0.04567591
          mapdata$slave_prop[mapdata$State_2017=="Maryland" & mapdata$County_2017=="Montgomery"]        <- 0.2958738
          mapdata$slave_prop[mapdata$State_2017=="Maryland" & mapdata$County_2017=="Montgomery"]        <- 0.2958738
          mapdata$slave_prop[mapdata$State_2017=="Maryland" & mapdata$County_2017=="Prince George's"]   <- 0.5349595
          mapdata$slave_prop[mapdata$State_2017=="Maryland" & mapdata$County_2017=="Washington"]        <- 0.04567591
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Jack"]              <- 0.05
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Montague"]          <- 0.04122497
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Cooke"]             <- 0.0981383
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Grayson"]           <- 0.157869
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Fannin"]            <- 0.1867202
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Lamar"]             <- 0.2794988
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Red River"]         <- 0.3560633
          mapdata$slave_prop[mapdata$State_2017=="Texas"    & mapdata$County_2017=="Bowie"]             <- 0.5247427
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Sevier"]            <- 0.3200837
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Polk"]              <- 0.04035664
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Scott"]             <- 0.04178814
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Sebastian"]         <- 0.07360901
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Crawford"]          <- 0.1092994
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Washington"]        <- 0.1017515
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Benton"]            <- 0.0412637
          mapdata$slave_prop[mapdata$State_2017=="Arkansas" & mapdata$County_2017=="Little River"]      <-  0.3200837
          mapdata$slave_prop[mapdata$State_2017=="Missouri" & mapdata$County_2017=="McDonald"]          <- 0.01783061
          mapdata$slave_prop[mapdata$State_2017=="Missouri" & mapdata$County_2017=="Newton"]            <- 0.04571306
          
          
          cat_list <- c("0", 				
                        "0-0.0631", 		
                        "0.06311-0.1666", 	
                        "0.16661-0.3221", 	
                        "0.32211-0.4957", 	
                        "0.49571-0.601", 	
                        "0.6011-0.925")

          
          mapdata$propbin <- "0"
          mapdata$propbin[mapdata$slave_prop > 0      & mapdata$slave_prop <= 0.0631] <- cat_list[2]
          mapdata$propbin[mapdata$slave_prop > 0.0631 & mapdata$slave_prop <= 0.1666] <- cat_list[3]
          mapdata$propbin[mapdata$slave_prop > 0.1666 & mapdata$slave_prop <= 0.3221] <- cat_list[4]
          mapdata$propbin[mapdata$slave_prop > 0.3221 & mapdata$slave_prop <= 0.4957] <- cat_list[5]
          mapdata$propbin[mapdata$slave_prop > 0.4957 & mapdata$slave_prop <= 0.601] <- cat_list[6]
          mapdata$propbin[mapdata$slave_prop > 0.6011 & mapdata$slave_prop <= 0.925] <- cat_list[7]

          mapdata$propbin[mapdata$County_2017=="Little River" & mapdata$State_2017=="Arkansas"]

          
          mapdata$propbin[mapdata$State_2017 == "Oklahoma"] <- cat_list[2]
          

          ### Colorcode Lynchings and Executions
          color_lynch <- c('0' = 'none', '1'= "#D4820F")
          color_execution <- c('0' = 'none', '1' = "#8b0000")
          
          mapdata$execution_colorcode <- 0

          mapdata$execution_colorcode[mapdata$Black_Execution_Count >= 1] <- "#8b0000"
          mapdata$execution_colorcode[mapdata$Black_Execution_Count < 1] <- "none"
          
          mapdata$lynching_colorcode <- 'none'

          mapdata$lynching_colorcode[mapdata$Black_Lynching_Count >= 1] <- "#D4820F"

          
          ### Coordinates for CircleMarkers
          sl <- unique(mapdata$State_Fips_2017[mapdata$State_Fips_2017!="72"])

          invisible(capture.output(us_county_shape <- counties(sl, cb = TRUE, year = NULL)))
          cds <- coordinates(us_county_shape)
          dot_coords <- cbind(as.data.frame(cds) %>% setNames(c("long","lat")),us_county_shape@data["GEOID"])
          mapdata <- sp::merge(mapdata,dot_coords, by = "GEOID")
          mapdata <- sp::merge(us_county_shape,mapdata, by = "GEOID", duplicateGeoms = TRUE)

          mapdata$Black_Lynching_Count[is.na(mapdata$Black_Lynching_Count)] <- 0
          mapdata$slave_prop[is.na(mapdata$slave_prop)] <- 0

          mapdata$long_lynch <- jitter(mapdata$long, factor = 50)
          mapdata$lat_lynch <- jitter(mapdata$lat, factor = 50)
          mapdata$long_ex <- jitter(mapdata$long, factor = 50)
          mapdata$lat_ex <- jitter(mapdata$lat, factor = 50)
          
          mapdata$County_Lynch_List[mapdata$County=="Duluth" & mapdata$State=="Minnesota"]

          
          ### MAKE MAP
          lynchup <- paste0("<B>Lynchings in ",mapdata$County, ", ", mapdata$State,"</B> </br>", mapdata$County_Lynch_List)
          exup    <- paste0("<B>Executions in ",mapdata$County, ", ", mapdata$State,"</B> </br>", mapdata$County_Ex_List)
          popup   <- paste0("<B> County: ",mapdata$County_1990, ", ", mapdata$State_2017, ":</br>",
                          "Prop. Enslaved 1860: ", round(mapdata$slave_prop, digits=3))
          binpal <- colorFactor(c("white", "#cecddb", "#9d9bb8", "#6d6994", "#3c3771", "#0a0546"), na.color = "white", domain = mapdata$propbin)
          
          dot_map <- leaflet(mapdata) %>%
            addProviderTiles("CartoDB.Positron") %>%
            addPolygons(data = mapdata,
                        stroke = TRUE,
                        opacity=.15,
                        color="grey", 
                        fillColor = ~binpal(mapdata$propbin), # you need to use hex colors
                        fillOpacity = .7, 
                        weight = .5, 
                        smoothFactor = 0.2,
                        popup = popup,               
                        highlightOptions = highlightOptions(color = "black", weight = 1, opacity = 2,
                                                            bringToFront = TRUE)) %>%
            
            addPolylines(data = mapdata,                  
                         stroke = TRUE,
                         weight = .5,
                         color="grey") %>%
            
            addCircleMarkers(lng = mapdata$long_ex, lat = mapdata$lat_ex, 
                             radius = ~ 5*log(1+(1.5*Black_Execution_Count)), weight=1, opacity = .4,
                             color= mapdata$execution_colorcode, stroke = TRUE, fillOpacity = .4, popup = exup) %>%
            
            addCircleMarkers(lng = mapdata$long_lynch, lat = mapdata$lat_lynch, 
                             radius = ~ 5*log(1+(Black_Lynching_Count/4)), weight=1, opacity = .4,
                             color= mapdata$lynching_colorcode, stroke = TRUE, fillOpacity = .4, popup = lynchup) %>%
            
            addLegend( 
              colors =  c("white", "#e6e6ec", "#b5b4c7", "#8482a2", "#53507d", "#221d58", "#080438"),
              labels = c("0", "0.01-0.06", "0.06-0.16", "0.17-0.32", "0.33-0.49", "0.50-0.60", "0.60-0.93"),
              position = "bottomright", 
              title = "Proportion Enslaved by County (1860 Census)") %>%
            
            addLegend( 
              colors =  c("#D4820F", "#580000"),
              labels = c("Lynching", "Execution"),
              position = "bottomleft",
              title = "Lynchings and Legal Executions in the US") 
          

          lynch_execution_map <- setView(dot_map,lat = 39, lng = -97, zoom = 5)
```


Column
-----------------

###

```{r}
lynch_execution_map
```


